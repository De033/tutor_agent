好的，这是一份为您精心准备的、完整而全面的项目使用手册。本手册旨在覆盖从首次安装到高级功能使用的所有方面，帮助任何用户或开发者快速上手并深度使用这个智能导师系统。

---

# AI智能导师系统 - 综合使用手册
## 1. 系统简介
欢迎使用AI智能导师系统！这不仅仅是一个问答机器人，更是一个能与您共同成长的个性化学习伙伴。它基于先进的多智能体（Multi-Agent）架构，旨在提供一个从知识探索、引导式学习、到科学记忆的完整闭环体验。
### 1.1 核心功能
*   **动态知识库构建**: 无需依赖预设课程。您可以直接告诉AI想学的主题，或者上传一篇相关的文章、笔记、PDF文档，系统将自动为您分析并构建一个结构化的知识库。
*   **个性化引导式教学**: 系统会模拟一位经验丰富的苏格拉底式导师，通过提问和引导，帮助您真正理解知识点，而不仅仅是被动接收。
*   **自动化闪卡创建**: 在您与AI导师的对话学习过程中，系统会自动识别值得记忆的核心知识点，并依据认知科学的**概念/描述框架**理论，在后台为您创建高质量、原子化的复习闪卡。
*   **科学的间隔重复记忆**: 系统集成了顶尖的**FSRS（Free Spaced Repetition Scheduler）算法**。它会像Anki一样，在您即将遗忘的时刻，智能地推送需要复习的卡片，实现知识的高效、长期巩固。

### 1.2 目标用户

*   **学习者**: 任何希望系统性学习新知识，并建立自己长期知识库的学生、研究人员和终身学习者。
*   **开发者**: 对构建基于大型语言模型（LLM）的复杂应用、多智能体系统感兴趣的开发者和研究者。

---

## 2. 安装与配置

### 2.1 环境准备

*   **Python**: 请确保您的系统中已安装 Python 3.9 或更高版本。
*   **Git**: 用于克隆本项目的代码仓库。

### 2.2 安装步骤

1.  **克隆项目代码**
    打开终端，执行以下命令：
    ```bash
    git clone <your_project_repository_url>
    cd <your_project_directory>
    ```

2.  **创建并激活虚拟环境 (推荐)**
    为了保持项目依赖的纯净，强烈建议您使用虚拟环境。
    ```bash
    # For Windows
    python -m venv venv
    .\venv\Scripts\activate

    # For macOS/Linux
    python3 -m venv venv
    source venv/bin/activate
    ```

3.  **安装项目依赖**
    本项目的所有依赖都记录在 `requirements.txt` 文件中。
    ```bash
    pip install -r requirements.txt
    ```

### 2.3 关键配置：API密钥

本项目需要连接大型语言模型（LLM）服务，因此必须配置API密钥。

1.  **创建 `.env` 文件**
    在项目的根目录下，创建一个名为 `.env` 的新文件。这是存放机密信息的标准做法，该文件已被`.gitignore`忽略，不会被上传到代码仓库。

2.  **配置密钥和API地址**
    在 `.env` 文件中，按照以下格式填入您的信息：

    ```dotenv
    # 示例: 使用第三方代理服务
    # OPENAI_COMPATIBLE_API_KEY="your_custom_key_if_any"
    # OPENAI_COMPATIBLE_API_BASE="https://your.proxy.url/v1"
    ```


3.  **其他配置 (可选)**
    您可以查看 `config/settings.json` 文件。这里包含了一些非敏感的配置，例如模型的温度（`temperature`）等，您可以根据需要进行调整。系统加载配置的优先级为：**代码写死的值 < `settings.json` 文件 < 环境变量**，因此 `.env` 文件中的配置优先级最高。

### 2.4 运行程序

本项目提供了两种交互界面：

*   **Web图形界面 (推荐)**: 运行 `run_webapp.py`。
    ```bash
    python run_webapp.py
    ```
    然后在浏览器中打开显示的地址（通常是 `http://127.0.0.1:7860`）。

*   **命令行界面**: 运行 `main.py`。
    ```bash
    python main.py
    ```
    这将在您的终端中启动一个纯文本的交互式会话。

---

## 3. 功能使用详解

### 3.1 开启一个新的学习会话

您可以通过两种方式启动一个全新的学习主题。

#### 方式一：通过定义主题

1.  **提出学习目标**: 直接在对话框中告诉AI您想学什么。
    > **您**: `你好，我想学习一下关于Python的“装饰器”`

2.  **需求分析**: AI导师会像一位真正的顾问一样，向您提问以明确学习范围。
    > **AI**: `好的！为了更好地为您规划，您能告诉我您希望了解装饰器的哪些方面吗？例如，它的基本语法、带参数的装饰器、类装饰器等等。`

3.  **计划确认**: 在收集完信息后，AI会生成一个“学习蓝图”并向您确认。
    > **AI**: `好的，根据您的需求，我为您规划了以下学习路径：[基本语法, 带参数的装饰器, 应用场景]。我们现在开始吗？`

4.  **开始学习**: 您确认后，系统会自动在后台为您创建专属的结构化知识库，并开启第一个话题的教学。

#### 方式二：通过上传文档

1.  **上传文件**: 在Web界面中，点击“上传文件”按钮，选择一篇与您想学习的主题相关的PDF、TXT或Markdown文件。

2.  **内容分析与计划确认**: 系统会自动阅读并分析整份文档，然后提炼出核心主题和章节大纲，并向您确认学习计划。
    > **AI**: `我分析了您上传的文件，它似乎是关于'线性代数'的。我为您规划了以下学习路径：[向量空间, 线性变换, 特征值与特征向量]。您觉得这个计划如何？`

3.  **开始学习**: 您确认后，系统将以这份文档为核心参考，为您创建知识库并开始教学。

### 3.2 核心教学循环

在教学过程中，您将体验到一个动态的、引导式的学习流程。

*   **苏格拉底式提问**: AI不会直接灌输知识，而是通过提问来启发您的思考。
    > **AI**: `... 这就是装饰器的基本语法。现在，您能尝试解释一下，为什么说装饰器本质上是一个函数呢？`

*   **智能反馈**: 系统会根据您回答的准确性，来决定下一步的行动。
    *   **回答正确**: AI会予以肯定，并可能提出更深层次的问题，或自然地过渡到下一个知识点。
    *   **部分正确**: AI会指出您理解正确的部分，并对模糊或错误的部分进行引导和澄清。
    *   **回答错误**: AI会耐心地重新解释概念，或提供一个更简单的例子来帮助您理解。

*   **自动闪卡创建 (核心亮点)**: 这是在后台自动发生的！当您与AI的对话清晰地阐明并确认了一个知识点后，系统会自动在后台为您创建一张或多张高质量的闪卡。您会收到一条低调的提示：
    > **AI**: `💳 我已将刚才的知识点分解，为你创建了 2 张更易于记忆的原子化卡片。`
    > `... 接下来，我们来谈谈带参数的装饰器...`
    您无需任何操作，学习过程无缝衔接，但宝贵的知识已经被自动存入您的长期记忆库中。

### 3.3 复习与记忆巩固

1.  **触发复习**: 当您想复习时，只需向AI发出指令。
    > **您**: `我要复习` 或 `开始复习闪卡`

2.  **FSRS间隔重复**: 系统会启动复习模块。它会根据FSRS算法，从您的复习库中挑选出当前最需要复习的卡片。

3.  **复习流程**:
    *   系统会首先展示卡片的“问题”面。
    *   您在心中回忆答案。
    *   点击“显示答案”，系统会展示“答案”面。
    *   根据您的回忆情况，点击对应的按钮（例如：“忘记了”、“困难”、“良好”、“轻松”）。您的这个反馈是FSRS算法调整后续复习计划的关键依据。

---

## 4. 数据与文件结构

您的所有学习数据都以开放的JSON格式保存在本地，赋予您完全的数据所有权。

*   `knowledge_bases/`
    *   此目录存放所有AI为您动态生成的**结构化知识库**。
    *   每个主题对应一个 `.json` 文件，例如 `Python装饰器.json`。
    *   您可以打开这些文件查看或（谨慎地）手动编辑其中的“定义”、“示例”等内容。

*   `reviews/`
    *   此目录存放您的**个人复习数据**。
    *   `default_user_review_deck.json` (或类似文件) 保存了您所有的闪卡。
    *   文件内不仅有卡片的“问题”和“答案”，还记录了每张卡片的FSRS状态（如`due`, `stability`, `difficulty`等），这是实现科学记忆的核心。

---

## 5. 高级用户与开发者指南

### 5.1 修改AI核心行为：Prompt工程

本系统的所有AI行为都由 `core/orchestrator.py` 文件中的Prompt定义。这是修改和定制AI行为的核心区域。

*   **定位Prompt**: 在 `orchestrator.py` 中，找到以 `_create_..._agent` 命名的方法，例如 `_create_pedagogical_strategy_agent`。
*   **修改Prompt**: 每个方法内的 `system_prompt` 字符串就是对应智能体的“灵魂”。您可以直接修改这些文本来调整AI的角色、思考流程、输出风格等。例如，您可以将闪卡生成的Prompt调整为您更喜欢的风格。

### 5.2 添加新的工具

您可以扩展AI的能力，让它调用您自己编写的Python函数。

1.  **创建函数**: 在 `core/tools_custom.py` 中，编写您的新函数。请确保为函数和其参数提供清晰的类型注解和文档字符串，因为AI会依赖这些信息来理解如何使用该工具。
2.  **注册工具**: 在 `core/orchestrator.py` 中，找到您希望赋予其新能力的智能体（通常是 `_create_guidance_agent`），将您的新工具实例化并添加到其 `tools` 列表中。

---

## 6. 常见问题 (FAQ)

*   **Q: AI似乎卡住了或不断重复同样的话，怎么办？**
    *   A: 这可能是LLM遇到了一个难以处理的边界情况。最简单的解决方法是尝试说“我们换个话题吧”来重置当前的微观循环，或者在Web界面中点击“清除历史记录”来开启一个全新的会话。

*   **Q: 我可以重置我所有的学习进度和卡片吗？**
    *   A: 当然。只需删除 `knowledge_bases/` 和 `reviews/` 目录下的相关 `.json` 文件，下次启动程序时，一切就会从零开始。

*   **Q: 我可以更换使用的LLM模型吗？**
    *   A: 可以。您可以在 `config/settings.json` 文件中修改 `model_type` 字段。同时，请确保您在 `.env` 文件中配置了对应模型的API密钥和地址。

*   **Q: 为什么有时候AI创建的闪卡不是我想要的？**
    *   A: 闪卡的生成质量高度依赖于`_create_single_flashcard_agent` 的Prompt。您可以尝试按照5.1节中的指导，修改该Prompt，例如提供更符合您偏好的示例，来“教会”AI生成您喜欢的卡片风格。